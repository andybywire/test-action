on: [push]

jobs:
  refresh-feed:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch API Data ðŸ“¦
        uses: JamesIves/fetch-api-data-action@releases/v1
        id: data
        with:
          ENDPOINT: https://4g5tw1k0.api.sanity.io/v2021-03-25/data/query/production?query=*[0]
          CONFIGURATION: '{ "method": "GET", "headers": {"Authorization": "Bearer ${{ secrets.SANITY_ACTIONS_TOKEN }}"} }'
      - name: Print out data
        run: echo "Data retrieved is ${{ steps.data.outputs.FETCH_API_DATA }}"
  hello_world_job:
    runs-on: ubuntu-latest
    name: A job to say hello
    needs: refresh-feed
    steps:
      - uses: actions/checkout@v1
      - name: Hello world action step
        id: hello
        uses: ./.github/actions/test-action
        with:
          who-to-greet: 'Marvin the fierce'
          sanity-data: ${{env.FETCH_API_DATA}}
      # Use the output from the `hello` step
      - name: Get the output time
        run: echo "The time was ${{ steps.hello.outputs.time }}"
